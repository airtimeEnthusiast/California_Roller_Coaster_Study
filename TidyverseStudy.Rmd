---
title: "2021 California \nCoasters Study"
author: "Written by Austin Wright"
date: "11/10/2021"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(ggplot2)
library(plotly)
library(htmlwidgets)
library(plyr)
library(reshape2)
knitr::opts_chunk$set(echo = FALSE)
options(warn=-1)
```



## Background and Purpose
 | The Data Frame |
 v                v
```{r Load-df}
rawDataFrame <- "./data/ca_data.csv"
currentDataFrame <- read.csv(rawDataFrame)
currentDataFrame
```

```{r Set Enviromental Vars}
#currentDataFrame <-na.omit(currentDataFrame)


```

Intro:
Ever since I was tall enough to go on a thrilling roller coaster, they have been a relatively interesting hobby for many reasons besides the wonderful rush of adrenaline. Roller Coasters are great models of reality such as structural and mechanical engineering, programmable logic software, control theory and statistical analysis in this case. In this report I choose to focus on roller coasters within the state of California because it is currently the state with the most roller coasters about 93 as of this report with a few new coasters to open in 2022 as well as some that are in the process of being removed. Many coasters such as children coasters have very similar layouts, little information on stats, and lack interesting characteristics so they might not be emphasized much for this reason. However it is quite obvious that some things cannot be analyzed easily such as rider hourly capacity and inconsistency with ride duration. Some stats however were relatively easy to find such as height, speed, inversion count, manufacture, and manufacture model name/type. I have ridden over 90% of the coasters on this list more than once so I have a good idea of the ride experience.

## Sources
Data Sources				
https://rcdb.com/r.htm?ot=2&ex&ol=1499				CA existant coasters according to RCDB
More info on Big Thunder https://en.wikipedia.org/wiki/Big_Thunder_Mountain_Railroad				
https://stg.statcrunch.com/app/index.php?dataid=2188685				
https://www.youtube.com/watch?v=FfDonRPuYZg				Coastersaurus
https://www.youtube.com/watch?v=QIG3wVbR6pw				 Canyon Blaster
https://rcdb.com/r.htm?ot=2&mo=8280				Coast Rider
https://rcdb.com/4003.htm			Same model as cobra	
https://sbfrides.com/products/spinning-coaster/				 SBF Visa Spinning coaster
https://www.youtube.com/watch?v=W8oEo96_QnU				 Dragon Legoland
https://coasterpedia.net/wiki/Dragon_(Legoland_California)				
https://rcdb.com/1478.htm			Same model as Goofy's Sky School	
https://en.wikipedia.org/wiki/The_Grizzly				
https://en.wikipedia.org/wiki/Incredicoaster				
https://en.wikipedia.org/wiki/Matterhorn_Bobsleds				
https://en.wikipedia.org/wiki/Space_Mountain_(Disneyland)				
https://www.ultimaterollercoaster.com/coasters/timber-twister				

## Study Information
Study:
Since this assignment requires the use of Tidyverse I choose some questions to answer such a 

## Purpose
Purpose:
Since I am a big fan of many of these roller coasters, I want to see how they compare stat wise

## Questions 
|   |                                                       |
|:--|:------------------------------------------------------| 
|1. | Height versus Speed of all the coasters?              |
|2. | What are the fastest roller coasters?                 |
|3. | What are the tallest coasters?                        |
|4. | What are the longest coasters?                        |
|5. | What are the coasters with the most inversions        |
|6. | The Most popular coaster models from each manufacture |
|7. | The average height from each manufacture's coasters   |
|8. | The average speed from each manufacture's coasters    |
|9. | Questions(1-4 with my top 10 favorites)               |
|10.| Popular Models within eras                            |
|11.| Parks with the most coasters                          |


## Data Dictionary
| Term                           | Type                   | description                                                                                                                             |
|:-------------------------------|:-----------------------|:----------------------------------------------------------------------------------------------------------------------------------------|
| Six Flags                      | Cooperate Chain        | The largest US themepark operator and own two parks in California (Six Flags Magic Mountain, Six Flags Discovery Kingdom)               |                                     
| Cedar Fair                     | Cooperate Chain        | Operate three regional parks in California (California's Great America, Knott's Berry Farm, Gilroy Gardens)                             |
| Sea World                      | Cooperate Chain        | Owner of Sea World San Diego                                                                                                            |
| Disney                         | Cooperate Chain        | Owner of California Adventure and Disneyland                                                                                            |
| Universal Studios              | Cooperate Chain        | Owner of Universal Studios Hollywood                                                                                                    |
| Merlin Entertainment           | Cooperate Chain        | Owner of Legoland California                                                                                                            |
| Wood                           | Roller Coaster Type    | A coaster which is supported by wood a structure and has wood track not typically capable of inversions                                 |
| Steel                          | Roller Coaster Type    | A coaster constructed out of steel supports and steel track typically capable of inversions                                             |
| Inversion                      | Coaster Element        | A section of coaster track where the roller coaster riders will be turned upside down. Elements like vertical loops, corkscre           |
| Great Coasters International   | Manufacturer           | Specialize in only wooden coasters which typically have banked turned in a "twister" style track layout                                 |
| Bollinger & Mabillard          | Manufacturer           | Builder of coasters for their high reliability, smoothness and high inversion count, B&M has been one of the most popular ma            |
| Intamin                        | Manufacturer           | Known as industry leader with many coasters with record breaking stats such as height or speed and technological innovatio              |
| Premier Rides                  | Manufacturer           | An expert in launch coasters and developed the first coaster to use a LIM proposition mechanism. Premier only manufactures sel coasters |
| Mack Rides                     | Manufacturer           | Manufacture in preminum steel family lauch coasters and spinning coasters. Mack only manufactures steel coasters                        |
| Schwarzkopf                    | Manufacturer           | Defunct manufacture that was an industry leader in the late 70s to late 80s in steel looping coasters                                   |
| Arrow Development              | Manufacturer           | Defunct manufacture that was an industry leader from the 1950s till their bankruptcy in 2002 the created the first tu                   |
| E&F Miller                     | Manufacturer           | Defunct manufacture of small scale steel family and kid friendly coasters                                                               |
| Wisdom Rides                   | Manufacturer           | Number of previous bookings that were cancelled by the customer prior to the current booking                                            |
| Wiegand                        | Manufacturer           | Leader of creating Alpine style coasters for ski resorts                                                                                |
| Zamperla                       | Manufacturer           | Large player of designing non-coaster ride like flatrides have a recent history of building family steel coasters                       |
| D.H Morgan                     | Manufacturer           | Defunct manufacture started by son of one of the founders of Arrow Development, specialized in steel coasters and designing troden coas |
| booking_changes                | Manufacturer           | Number of changes/amendments made to the booking from the moment the booking was entered on the PMS until the moment of check-in or can |
| Rocky Mountain Construction    | Manufacturer           | The "Tesla" of roller coaster manufactures due to their recent widespread popularity and disruptive hybrid roller coaster models with w |
| Maurer                         | Manufacturer           | ID of the travel agency that made the booking                                                                                           |
| Dynamic Attractions            | Manufacturer           | ID of the company/entity that made the booking or responsible for paying the booking. ID is presented instead of designation fty reasons|
| days_in_waiting_list           | double                 | Number of days the booking was in the waiting list before it was confirmed to the customer                                              |
| customer_type                  | character              | Type of booking, assuming one of four categories:<br>Contract - when the booking has an allotment or other type of contract associated t|
| adr                            | double                 | Average Daily Rate as defined by dividing the sum of all lodging transactions by the total number of staying nights                     |
| required_car_parking_spaces    | double                 | Number of car parking spaces required by the customer                                                                                   |
| total_of_special_requests      | double                 | Number of special requests made by the customer (e.g. twin bed or high floor                                                            |
| reservation_status             | character              | Reservation last status, assuming one of three categories:<br>Canceled – booking was canceled by the customer;<br>Check-Out – customer  | 
| reservation_status_date        | double                 | Date at which the last status was set. This variable can be used in conjunction with the ReservationStatus to understand when was the   |

```{r mode freq iterator functions}
# https://stackoverflow.com/questions/8545590/find-the-most-popular-element-in-int-array
# https://stackoverflow.com/questions/5738831/r-plus-equals-and-plus-plus-equivalent-from-c-c-java-etc
# Below are some functions for the next section 

getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}


count <- 0
inc <- function(count)
{
 eval.parent(substitute(count <- count + 1))
}

#Frequency of a column
countMode <- function(catagory){
  previous <- catagory[1]
  popular <- catagory[1]
  maxCount <- 1
  for (i in 1 : length(catagory)) {
    if(previous == catagory[i]){
     inc(count)
    }
    else{
        if(count > maxCount){
          popular <- catagory[i - 1]
          maxCount = count;
        }
    }
  }
  return <- maxCount
}


```

## 0.  Length versus height
```{r Existant Coasters statisical breakdown length and height}

scatterPlot2 <- currentDataFrame %>% 
  ggplot(width = 700, height = 700,mapping = aes(x = Length, y = Height, 
             text = paste(
             Name, " at ", Park, "\n", 
                "Description: ", Type ,"", Model.Name, "\n",
                "Built by", Manufacturer, " in ", Year,"\n",
             Length, " ft \n",
             Height, " ft \n"))) + geom_smooth(method = "lm", color = "yellow") +
  geom_point(aes(color = Type)) + 
  labs(x = "Length", 
       y = "Height",
       title = "Length compared to Height Of All Coasters") +
  geom_hline(yintercept=0, linetype="dashed", color = "#2C528C", size=0.5) + geom_vline(xintercept=0, linetype="dashed", color = "#2C528C", size=0.5) 

ggplotly(scatterPlot2, tooltip = "text")
```

## 1. Height VS Speed
```{r All Height VS Speed }
scatterPlot <- currentDataFrame %>% 
  ggplot(mapping = aes(x = Speed, y = Height, 
             text = paste(
             Name, " at ", Park, "\n", 
                "Description: ", Type ,"", Model.Name, "\n",
                "Built by", Manufacturer, " in ", Year,"\n",
             Speed, " mph \n",
             Height, " ft \n"))) + geom_smooth(method = "lm", color = "yellow") +
  geom_point(aes(color = Type)) + 
  labs(x = "Speed", 
       y = "Height",
       title = "Speed compared to Height Of All Coasters") +
  geom_hline(yintercept=0, linetype="dashed", color = "#2C528C", size=0.5) + geom_vline(xintercept=0, linetype="dashed", color = "#2C528C", size=0.5) 

ggplotly(scatterPlot, tooltip = "text")

```



## 2. Speed Histogram
```{r Speed historgram}
c_year <- c(currentDataFrame$Year)
c_speed <- c(currentDataFrame$Speed)
c_types <- c(currentDataFrame$Type)

x <- c(currentDataFrame$Year)
y <- c(currentDataFrame$Speed)

text <- c(currentDataFrame$Name)
data <- data.frame(c_year, c_speed, text)

currentDataFrame %>%
  plot_ly(width = 700, height = 700,text = text,
        marker = list(color = ~c_types,
      size = 20)) %>%
  add_bars(x= ~c_year, y = ~c_speed, color = ~c_types)
```


## 3.  Inversion Histogram
```{r Inversion historgram}
c_inversion<- c(currentDataFrame$Num.of.Inversions)

c_names <- c(currentDataFrame$Name)
y <- c(currentDataFrame$Num.of.Inversions)

text <- c(currentDataFrame$Name)
data <- data.frame(c_names, c_inversion, text)

currentDataFrame %>%
  plot_ly(width = 700, height = 700,text = text,
        marker = list(color = ~c_names,
      size = 20)) %>%
  add_bars(x= ~c_names, y = ~c_inversion, color = ~c_names)
```

## 4 .Height Histogram
```{r height historgram}
c_year <- c(currentDataFrame$Year)
c_height <- c(currentDataFrame$Height)
c_types <- c(currentDataFrame$Type)

x <- c(currentDataFrame$Year)
y <- c(currentDataFrame$Height)

text <- c(currentDataFrame$Name)
data <- data.frame(c_year, c_height, text)

currentDataFrame %>%
  plot_ly(width = 700, height = 700,text = text,
        marker = list(color = ~c_types,
      size = 20)) %>%
  add_bars(x= ~c_year, y = ~c_height, color = ~c_types)
```

## 5. Popular Models From Each Manufacture
```{r Popularity}



df <- currentDataFrame %>% select(Manufacturer, Model.Name)
manufactures = c(df$Manufacturer)
listOfMan <- manufactures[!duplicated(manufactures)]

Models = length(listOfMan) + 1
Installations = 2
table <-data.frame(Models,Installations)

for(i in 1 : length(listOfMan))
{
    nextFrame <- df %>% filter(Manufacturer == listOfMan[i])
    nextlistOfMods <- nextFrame$Model.Name
    nextMode <- getmode(nextFrame$Model.Name)
    nextFreq <- countMode(nextlistOfMods)
    table[i,1] <- nextMode
    table[i,2] <- nextFreq
}
mods <- c(table$Models)            #x axis data v 
installs <- c(table$Installations) #y axis data v
text <- listOfMan
fig <- plot_ly(x = mods, y = installs, name = ~listOfMan, type = "bar", color = ~listOfMan, width = 8)
fig 

#Subset the data to make the graph above better to understand such as a Top 10 thingy
#tateFarmSubset <- subset(currentDataFrame, subset=((Height <= 70) & (manufactures == "State Farm Mut Grp")) , #select=c("AccidentYear","CumPaidLoss_B")) #data frame containing state farm paid losses (B) and accident years for development lags of 10

#table <- data.frame(table)
#class(table)
#table
#mtrx <- setNames(installs,mods) #set the table for every year's loss
#barplot(mtrx, xlab = "Model", ylab = "Num of Installations", main = "Installations ", col = rainbow(length(mods)),horiz = TRUE)

```

## 6. Average Height From Each Manufacture
```{r Avg Height for each Manufacture}

df <- currentDataFrame %>% select(Manufacturer, Height)
ManufacturesNames = length(listOfMan) + 1
Avg_Height = 2
table <-data.frame(ManufacturesNames,Avg_Height)

for(i in 1 : length(listOfMan))
{
    nextFrame <- df %>% filter(Manufacturer == listOfMan[i])
    nextName <- listOfMan[i]
    nextAvg <- mean(nextFrame$Height)
    table[i,1] <- nextName
    table[i,2] <- nextAvg
}

names <- c(table$ManufacturesNames)            #x axis data v 
heights <- c(table$Avg_Height) #y axis data v
text <- listOfMan
fig <- plot_ly(x = names, y = heights, name = ~listOfMan, type = "bar", color = ~listOfMan, width = 8)
fig 
```

## 7. Average Speed from each Manufacture
```{r Avg Speed for each Manufacture}

df <- currentDataFrame %>% select(Manufacturer, Speed)
ManufacturesNames = length(listOfMan) + 1
Avg_Speed = 2
table <-data.frame(ManufacturesNames,Avg_Speed)

for(i in 1 : length(listOfMan))
{
    nextFrame <- df %>% filter(Manufacturer == listOfMan[i])
    nextName <- listOfMan[i]
    nextAvg <- mean(nextFrame$Speed)
    table[i,1] <- nextName
    table[i,2] <- nextAvg
}

names <- c(table$ManufacturesNames)            #x axis data v 
speeds <- c(table$Avg_Speed) #y axis data v
text <- listOfMan
fig <- plot_ly(x = names, y = speeds, name = ~listOfMan, type = "bar", color = ~listOfMan, width = 8)
fig 
```

## 8. Popular Models in different eras
```{r Popular Models within eras}

```

## 9. parks with the most coasters
```{r Parks with the most coasters}

```


